---
import { getLangFromUrl, useTranslations } from '../i18n/translations';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<div id="cookie-consent" class="hidden fixed bottom-0 left-0 right-0 bg-slate-900 text-white p-4 shadow-2xl z-50 border-t-2 border-primary-600">
  <div class="container-custom">
    <div class="flex flex-col md:flex-row items-center justify-between gap-4">
      <div class="flex-1">
        <p class="text-sm md:text-base">
          {lang === 'sk' 
            ? 'Táto stránka používa cookies na analytické účely. Pokračovaním v používaní stránky súhlasíte s ich používaním. Môžete ich odmietnuť kliknutím na tlačidlo nižšie.'
            : lang === 'hu'
            ? 'Ez az oldal sütiket használ elemzési célokra. Az oldal további használatával Ön hozzájárul ezek használatához. Az alábbi gombra kattintva leiratkozhat.'
            : 'This site uses cookies for analytics. By continuing to use this site, you consent to their use. You can opt out by clicking the button below.'
          }
          <a href={`${lang === 'sk' ? '' : `/${lang}`}/cookies`} class="underline hover:text-primary-400 ml-1">
            {lang === 'sk' ? 'Viac informácií' : lang === 'hu' ? 'További információ' : 'More information'}
          </a>
        </p>
      </div>
      <div class="flex gap-3">
        <button 
          id="cookie-accept" 
          class="px-6 py-2 bg-primary-600 hover:bg-primary-700 rounded-lg font-semibold transition-colors whitespace-nowrap"
        >
          {lang === 'sk' ? 'Rozumiem' : lang === 'hu' ? 'Értem' : 'Got it'}
        </button>
        <button 
          id="cookie-decline" 
          class="px-6 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg font-semibold transition-colors whitespace-nowrap"
        >
          {lang === 'sk' ? 'Odmietnuť' : lang === 'hu' ? 'Elutasítom' : 'Opt out'}
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  // Check if user has already made a choice
  const cookieConsent = localStorage.getItem('cookieConsent');
  const consentBanner = document.getElementById('cookie-consent');
  
  // Show banner only if user hasn't made a choice yet
  if (!cookieConsent && consentBanner) {
    consentBanner.classList.remove('hidden');
  }
  
  // Accept/acknowledge cookies (analytics already enabled by default)
  document.getElementById('cookie-accept')?.addEventListener('click', () => {
    localStorage.setItem('cookieConsent', 'accepted');
    consentBanner?.classList.add('hidden');
  });
  
  // Decline/opt-out of cookies
  document.getElementById('cookie-decline')?.addEventListener('click', () => {
    localStorage.setItem('cookieConsent', 'declined');
    consentBanner?.classList.add('hidden');
    
    // Disable Google Analytics
    if (window.gtag) {
      window.gtag('consent', 'update', {
        'analytics_storage': 'denied'
      });
    }
    
    // Disable GA tracking immediately
    window['ga-disable-G-J93S09JDJL'] = true;
    
    // Reload page to apply changes
    window.location.reload();
  });
</script>
